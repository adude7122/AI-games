<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced Paint App</title>
<style>
:root {
  --bg: #ffffff;
  --fg: #000000;
  --panel: #f0f0f0;
  --border: #ccc;
  --accent: #0078ff;
  --button: #e0e0e0;
  --button-active: #c0c0c0;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #121212;
    --fg: #ffffff;
    --panel: #1e1e1e;
    --border: #333;
    --button: #2a2a2a;
    --button-active: #3a3a3a;
  }
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--fg);
  font-family: sans-serif;
  display: flex;
  height: 100vh;
}

#toolbar {
  width: 260px;
  background: var(--panel);
  border-right: 1px solid var(--border);
  padding: 10px;
}

h3 { margin: 10px 0 6px; }

button {
  width: 100%;
  margin-bottom: 6px;
  padding: 6px;
  background: var(--button);
  color: var(--fg);
  border: 1px solid var(--border);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
  transition: all 0.1s ease;
}

button:hover { background: var(--button-active); }
button:active { transform: translateY(1px); }
button.active { background: var(--accent); color: white; border-color: var(--accent); }

input {
  background: var(--bg);
  color: var(--fg);
  border: 1px solid var(--border);
  padding: 5px;
  width: 100%;
}

input[type="range"] {
  appearance: none;
  height: 6px;
  background: var(--border);
  border-radius: 3px;
  outline: none;
}

input[type="range"]::-webkit-slider-thumb {
  appearance: none;
  width: 14px; height: 14px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
}
input[type="range"]::-moz-range-thumb {
  width: 14px; height: 14px;
  border-radius: 50%;
  background: var(--accent);
  cursor: pointer;
}

.color-row { display: flex; gap: 5px; margin-bottom: 6px; }

canvas { flex: 1; cursor: crosshair; background: white; }
</style>
</head>
<body>

<div id="toolbar">
  <h3>Tools</h3>
  <button data-tool="pencil"><span>‚úèÔ∏è</span>Pencil</button>
  <button data-tool="brush"><span>üñåÔ∏è</span>Brush</button>
  <button data-tool="line"><span>üìè</span>Line</button>
  <button data-tool="rect"><span>‚¨õ</span>Square</button>
  <button data-tool="circle"><span>‚ö™</span>Circle</button>
  <button data-tool="bucket"><span>ü™£</span>Bucket</button>

  <h3>Brush Size</h3>
  <input type="range" min="1" max="50" value="5" id="size">

  <h3>Color</h3>
  <div class="color-row">
    <input type="color" id="colorPicker">
  </div>
  <input type="text" id="hex" placeholder="#RRGGBB">
  <input type="text" id="rgb" placeholder="rgb(0,0,0)">
  <h3>Hue</h3>
  <input type="range" min="0" max="360" value="0" id="hue">

  <h3>Background</h3>
  <input type="color" id="bgPicker" value="#ffffff">

  <h3>Save</h3>
  <button id="savePNG">Save PNG</button>
  <button id="saveJPG">Save JPG</button>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth - 260;
canvas.height = window.innerHeight;

let tool = "brush", drawing = false;
let startX, startY, lastX, lastY;
let color = "#000000", bgColor = "#ffffff";
let imgDataBefore = null;

const buttons = document.querySelectorAll("button[data-tool]");
buttons.forEach(btn => btn.onclick = () => setTool(btn.dataset.tool));

function setTool(t) {
  tool = t;
  buttons.forEach(b => b.classList.toggle("active", b.dataset.tool === t));
}

setTool("brush");

const sizeInput = document.getElementById("size");
const colorPicker = document.getElementById("colorPicker");
const hexInput = document.getElementById("hex");
const rgbInput = document.getElementById("rgb");
const hueSlider = document.getElementById("hue");
const bgPicker = document.getElementById("bgPicker");

function updateColor(val) { color = val; if(val.startsWith("#")) colorPicker.value=val; }
colorPicker.oninput = () => updateColor(colorPicker.value);
hexInput.onchange = () => updateColor(hexInput.value);
rgbInput.onchange = () => updateColor(rgbInput.value);
hueSlider.oninput = () => updateColor(`hsl(${hueSlider.value},100%,50%)`);

bgPicker.oninput = () => { bgColor = bgPicker.value; redrawCanvas(); }

function redrawCanvas() {
  ctx.fillStyle = bgColor;
  ctx.fillRect(0,0,canvas.width,canvas.height);
  if(canvasHistory) ctx.putImageData(canvasHistory,0,0);
}

let canvasHistory = null;

canvas.addEventListener("mousedown", e => {
  drawing = true;
  startX = lastX = e.offsetX;
  startY = lastY = e.offsetY;
  if(tool === "bucket") { ctx.fillStyle=color; ctx.fillRect(0,0,canvas.width,canvas.height); }
  if(["line","rect","circle"].includes(tool)) imgDataBefore = ctx.getImageData(0,0,canvas.width,canvas.height);
});

canvas.addEventListener("mouseup", e => {
  if(!drawing) return; drawing=false;
  if(["line","rect","circle"].includes(tool)) {
    drawShape(e.offsetX, e.offsetY, true);
    imgDataBefore = null;
  }
});

canvas.addEventListener("mousemove", e => {
  if(["line","rect","circle"].includes(tool)) {
    if(drawing && imgDataBefore) {
      ctx.putImageData(imgDataBefore,0,0);
      drawShape(e.offsetX,e.offsetY,false);
    }
  } else if(drawing && (tool==="brush"||tool==="pencil")) {
    ctx.strokeStyle=color;
    ctx.lineWidth = tool==="pencil"?1:sizeInput.value;
    ctx.lineCap = "round";
    ctx.beginPath();
    ctx.moveTo(lastX,lastY);
    ctx.lineTo(e.offsetX,e.offsetY);
    ctx.stroke();
    lastX = e.offsetX; lastY = e.offsetY;
  }
});

function drawShape(x,y,final) {
  ctx.strokeStyle = color;
  ctx.lineWidth = sizeInput.value;
  ctx.fillStyle=color;
  if(!final) ctx.globalAlpha = 0.5;
  if(tool==="line"){ ctx.beginPath(); ctx.moveTo(startX,startY); ctx.lineTo(x,y); ctx.stroke();}
  if(tool==="rect"){ ctx.strokeRect(startX,startY,x-startX,y-startY);}
  if(tool==="circle"){ const r=Math.hypot(x-startX,y-startY); ctx.beginPath(); ctx.arc(startX,startY,r,0,2*Math.PI); ctx.stroke();}
  ctx.globalAlpha=1;
}

// Save
document.getElementById("savePNG").onclick = ()=>{ const a=document.createElement("a"); a.href=canvas.toDataURL("image/png"); a.download="paint.png"; a.click();}
document.getElementById("saveJPG").onclick = ()=>{ const a=document.createElement("a"); a.href=canvas.toDataURL("image/jpeg"); a.download="paint.jpg"; a.click();}

window.addEventListener("resize", () => {
  const img = ctx.getImageData(0,0,canvas.width,canvas.height);
  canvas.width = window.innerWidth-260;
  canvas.height = window.innerHeight;
  ctx.putImageData(img,0,0);
});
</script>
</body>
</html>
